{% extends 'playlstr/base.html' %}
{% load static %}
{% block head %}
    <title>Playlist</title>
    <script src="{% static 'js/playlist.js' %}"></script>
{% endblock %}
{% block content %}
    {% if playlist %}
        <script>
            let playlist_id = {{ playlist.playlist_id }};
            $(document).ready(function () {
                init();
            });
        </script>
        <div id="playlist" class="container-fluid">
            <h1 style="padding: 50px;" class="text-center" id="playlistName">{{ playlist.name }}</h1>
            <div id="playlistButtons">
                <div id="editControlButtons" class="row vmargin-sm">
                    {% if user.is_authenticated %}
                        {% if user in playlist.editors or user == playlist.owner %}
                            <button type="button" class="btn btn-primary btn-padding-h" id="editButton"
                                    onclick="enterEditMode();">
                                Edit
                            </button>
                            <div id="trackSearchButtons" style="display: none;">
                                <button type="button" class="btn btn-primary btn-padding-h" id="saveButton"
                                        onclick="exitEditMode(true)">Save
                                </button>
                                <button type="button" class="btn btn-secondary btn-padding-h" id="cancelButton"
                                        onclick="exitEditMode(false)">Cancel
                                </button>
                                <button id="enableTrackSearch" type="button" class="btn btn-primary btn-padding-h"
                                        onclick="toggleTrackSearch();">
                                    Add +
                                </button>
                            </div>
                        {% endif %}
                    {% endif %}
                    <button class="btn btn-primary btn-padding-h" type="button" id="exportButton"
                            onclick="window.location.href = 'http://' + window.location.host + '/export/{{ playlist.playlist_id }}';">
                        Export
                    </button>
                    {% if user.is_authenticated %}
                        <button class="btn btn-primary btn-padding-h" type="button" id="forkButton"
                                onclick="window.location.href = 'http://' + window.location.host + '/fork/{{ playlist.playlist_id }}';">
                            Fork
                        </button>
                    {% endif %}
                </div>
            </div>
            <div id="addTrackContainer" style="display:none;margin-bottom: 20px;">
                <div id="trackSearchInputs">
                    <div class="bg-success vmargin-sm" style="display: inline-block; width: 100%;"
                         id="addSuccessDialog">
                        Added!
                    </div>
                    <div id="searchContainer" class="form-inline" style="margin-top: 20px;">
                        <div id="trackSearchInputs" style="width: 70%;">
                            <div id="simpleTrackSearch" class="form-inline">
                                <input type="text" id="simpleTrackSearchText" name="simpleTrackSearchText"
                                       style="width: 100%;"
                                       class="form-control">
                            </div>
                            <!--
                            <div id="advancedTrackSearch" style="display: none; width: 100%;">
                                <form id="advancedTrackSearchForm" class="form-inline">
                                    <label for="aTrackSearchTitle">Title: </label>
                                    <input type="text" class="form-control" id="aTrackSearchTitle" style="margin: 5px;">
                                    <label for="aTrackSearchArtist">Artist: </label>
                                    <input type="text" class="form-control" id="aTrackSearchArtist"
                                           style="margin: 5px;">
                                    <label for="aTrackSearchAlbum">Album: </label>
                                    <input type="text" class="form-control" id="aTrackSearchAlbum" style="margin: 5px;">
                                </form>
                            </div>
                            -->
                        </div>
                        <div class="dropdown btn-padding-h dropdown-hover" style="margin-left: 10px;"
                             id="searchDropdown">
                            <button class="btn btn-success" type="button" id="searchDropdownButton"
                                    aria-haspopup="true" aria-expanded="false"
                                    onclick="searchDefault();" style="padding-bottom: 0.5rem;">
                                <i class="fa fa-search"></i> <i class="fa fa-angle-down"></i>
                            </button>
                            <div class="dropdown-menu" aria-labelledby="searchDropdownButton" id="searchButtonDropdown">
                                <a class="dropdown-item" href="#" onclick="searchSpotify();return false;"><i
                                        class="fa fa-spotify"></i></a>
                                <a class="dropdown-item" href="#" onclick="searchPlaylstr();return false;">Playlstr</a>
                            </div>
                        </div>
                        <div id="searchTypeSelectContainer">
                            <select class="custom-select" id="searchTypeSelect" onchange="setSearchTypeFromHtml();">
                                <option selected value="track">Tracks</option>
                                <option value="album">Albums</option>
                            </select>
                        </div>
                        <!--
                        <button type="button" class="btn btn-primary btn-padding-h vmargin-sm"
                                onclick="toggleAdvancedTrackSearch();">
                            Advanced
                        </button>
                        -->
                        <button id="manualAddButton" type="button" class="btn btn-primary btn-padding-h"
                                onclick="showNewTrackDialog()">
                            +
                        </button>
                    </div>
                </div>
                <div id="trackSearchResults" class="search-results-table">
                    <table class="table table-striped" id="trackSearchResultsTable">
                        <thead>
                        <tr>
                            <th id="searchTitleColumn">Title</th>
                            <th>Artist</th>
                            <th>Album</th>
                            <th>Add</th>
                        </tr>
                        </thead>
                        <tbody id="trackSearchResultsTBody">
                        </tbody>
                    </table>
                    <div id="noResultsInfo" style="padding-left: 10px;">No matching results. Try searching a different
                        site with the search button above.
                    </div>
                </div>
            </div>
        </div>
        <div id="trackList">
            <div id="newTracksWarning" class="container vmargin-sm text-warning" style="display: none;">
                You have added new tracks (indicated with <i class="fa fa-certificate"></i>). You must click save above
                to add these tracks.
            </div>
            <table class="table table-bordered pagin-table">
                <thead>
                <tr>
                    <th>Title</th>
                    <th>Artist</th>
                    <th>Album</th>
                    <th></th>
                    <th class="rm-btn-container" style="display: none;">Remove</th>
                </tr>
                </thead>
                <tbody id="trackListTBody">
                {% for track in tracks %}
                    <tr id="{{ track.track_id }}track">
                        <td><a href="/track/{{ track.track_id }}">{{ track.title }}</a></td>
                        <td>{{ track.artist }}</td>
                        <td>{{ track.album }}</td>
                        <td>
                            <button type="button" class="btn btn-dark" onclick="downloadTrack({{ track.track_id }})">
                                <i class="fa fa-download"></i>
                            </button>
                            <button type="button" class="btn btn-danger">
                                <i class="fa fa-play"></i>
                            </button>
                            {% if track.spotify_id is not None %}
                                <button id="{{ track.spotify_id }}SpotifyButton" type="button" class="btn btn-success"
                                        onclick="window.location = 'https://open.spotify.com/track/{{ track.spotify_id }}';">
                                    <i class="fa fa-spotify"></i>
                                </button>
                            {% endif %}
                        </td>
                        <td class="rm-btn-container" style="display: none;">
                            <button type="button" class="btn btn-outline-danger"
                                    onclick="deleteTrack({{ track.track_id }})">&#10060;
                            </button>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        Invalid playlist
    {% endif %}
{% endblock %}

